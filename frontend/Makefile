.PHONY: help install build dev test test-watch test-coverage lint fmt clean preview serve deploy

# Default target
help: ## Show this help message
	@echo "Frontend Makefile - Available Commands:"
	@echo ""
	@echo "Setup:"
	@echo "  install        - Install dependencies"
	@echo "  clean          - Clean build artifacts and node_modules"
	@echo ""
	@echo "Development:"
	@echo "  dev            - Start development server"
	@echo "  preview        - Preview production build"
	@echo "  serve          - Serve production build"
	@echo ""
	@echo "Building:"
	@echo "  build          - Build for production"
	@echo "  build-dev      - Build for development"
	@echo ""
	@echo "Testing:"
	@echo "  test           - Run tests"
	@echo "  test-watch     - Run tests in watch mode"
	@echo "  test-ui        - Run tests with UI"
	@echo "  test-coverage  - Run tests with coverage"
	@echo ""
	@echo "Code Quality:"
	@echo "  lint           - Lint code"
	@echo "  fmt            - Format code (fix linting issues)"
	@echo ""
	@echo "Deployment:"
	@echo "  deploy         - Deploy to Vercel"
	@echo "  deploy-preview - Deploy preview to Vercel"
	@echo ""
	@echo "Analysis:"
	@echo "  analyze        - Analyze bundle size"
	@echo "  audit          - Audit dependencies"
	@echo ""

# Setup
install: ## Install dependencies
	@echo "ğŸ“¦ Installing dependencies..."
	@npm install
	@echo "âœ… Dependencies installed"

clean: ## Clean build artifacts and node_modules
	@echo "ğŸ§¹ Cleaning..."
	@rm -rf dist/
	@rm -rf coverage/
	@rm -rf node_modules/
	@rm -f package-lock.json
	@echo "âœ… Cleanup complete"

# Development
dev: ## Start development server
	@echo "ğŸš€ Starting development server..."
	@echo "URL: http://localhost:5173"
	@npm run dev

preview: build ## Preview production build
	@echo "ğŸ‘€ Previewing production build..."
	@npm run preview

serve: build ## Serve production build
	@echo "ğŸŒ Serving production build..."
	@npx serve dist -s

# Building
build: ## Build for production
	@echo "ğŸ”¨ Building for production..."
	@npm run build
	@echo "âœ… Production build complete"

build-dev: ## Build for development
	@echo "ğŸ”¨ Building for development..."
	@npm run build -- --mode development
	@echo "âœ… Development build complete"

# Testing
test: ## Run tests
	@echo "ğŸ§ª Running tests..."
	@npm test

test-watch: ## Run tests in watch mode
	@echo "ğŸ‘€ Running tests in watch mode..."
	@npm test -- --watch

test-ui: ## Run tests with UI
	@echo "ğŸ¨ Running tests with UI..."
	@npm run test:ui

test-coverage: ## Run tests with coverage
	@echo "ğŸ“Š Running tests with coverage..."
	@npm run test:coverage
	@echo "âœ… Coverage report generated: coverage/index.html"

# Code Quality
lint: ## Lint code
	@echo "ğŸ” Linting code..."
	@npm run lint

fmt: ## Format code (fix linting issues)
	@echo "ğŸ¨ Formatting code..."
	@npm run lint -- --fix
	@echo "âœ… Code formatted"

# Deployment
deploy: ## Deploy to Vercel
	@echo "ğŸš€ Deploying to Vercel..."
	@npx vercel --prod
	@echo "âœ… Deployed to production"

deploy-preview: ## Deploy preview to Vercel
	@echo "ğŸ‘€ Deploying preview to Vercel..."
	@npx vercel
	@echo "âœ… Preview deployed"

# Analysis
analyze: ## Analyze bundle size
	@echo "ğŸ“Š Analyzing bundle size..."
	@npm run build
	@npx vite-bundle-analyzer dist/assets/*.js
	@echo "âœ… Bundle analysis complete"

audit: ## Audit dependencies
	@echo "ğŸ”’ Auditing dependencies..."
	@npm audit
	@echo "âœ… Audit complete"

audit-fix: ## Fix audit issues
	@echo "ğŸ”§ Fixing audit issues..."
	@npm audit fix
	@echo "âœ… Audit issues fixed"

# Development workflow
dev-setup: install ## Setup development environment
	@echo "âš™ï¸ Setting up development environment..."
	@if [ ! -f .env ]; then \
		echo "VITE_API_URL=http://localhost:8080/api" > .env; \
		echo "VITE_GOOGLE_CLIENT_ID=" >> .env; \
		echo "ğŸ“ Created .env file - please edit with your settings"; \
	fi
	@echo "âœ… Development environment ready"

dev-check: ## Check development environment
	@echo "ğŸ” Checking development environment..."
	@echo "Node version: $(shell node --version)"
	@echo "NPM version: $(shell npm --version)"
	@echo "Dependencies: $(shell npm list --depth=0 2>/dev/null | wc -l) packages installed"
	@if [ -f .env ]; then echo "âœ… .env file exists"; else echo "âŒ .env file missing"; fi
	@echo "âœ… Environment check complete"

# Quick commands
start: dev ## Alias for dev
restart: clean install dev ## Clean install and start dev server

# Build variants
build-analyze: build analyze ## Build and analyze bundle

# Test variants
test-all: test test-coverage ## Run all tests with coverage
test-ci: ## Run tests for CI
	@echo "ğŸ”„ Running tests for CI..."
	@npm test -- --run --reporter=verbose

# Utility commands
info: ## Show project information
	@echo "ğŸ“‹ Project Information:"
	@echo "Name: $(shell node -p "require('./package.json').name")"
	@echo "Version: $(shell node -p "require('./package.json').version")"
	@echo "Node: $(shell node --version)"
	@echo "NPM: $(shell npm --version)"
	@echo "Dependencies: $(shell npm list --depth=0 2>/dev/null | grep -c '@')"

deps-update: ## Update dependencies
	@echo "ğŸ”„ Updating dependencies..."
	@npm update
	@echo "âœ… Dependencies updated"

deps-outdated: ## Check for outdated dependencies
	@echo "ğŸ“… Checking for outdated dependencies..."
	@npm outdated
	@echo "âœ… Outdated check complete"
